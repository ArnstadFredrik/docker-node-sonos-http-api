<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <title>Sonos HTTP API by jishi</title>
</head>

<body>
    <header>
        <div class="container">
            <h1>Sonos HTTP API</h1>
            <h2>A simple HTTP API for Sonos to simplify automation. Hostable on any node.js capable device, like a raspberry pi or similar.</h2>
            <section id="downloads">
                <a href="https://github.com/jishi/node-sonos-http-api/releases" class="btn">Download from github</a>
                <a href="https://github.com/jishi/node-sonos-http-api/releases/download/v1.0.1/sonos-http-api-1.0.1.img.gz" class="btn">Download an image for raspberry pi</a>
                <a href="https://github.com/jishi/node-sonos-http-api" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
            </section>
        </div>
    </header>
    <div class="container">
        <section id="main_content">
            <p>
                <a href="https://www.paypal.me/jishi" title="Donate once-off to this project using Paypal"><img src="https://camo.githubusercontent.com/11b2f47d7b4af17ef3a803f57c37de3ac82ac039/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f70617970616c2d646f6e6174652d79656c6c6f772e737667" alt="PayPal donate button" data-canonical-src="https://img.shields.io/badge/paypal-donate-yellow.svg" style="max-width:100%;"></a>
            </p>
            <p><strong>This application requires node 4.0.0 or higher!</strong></p>
            <p><strong>This should now work with node 6, let me know if that is not the case.</strong></p>
            <p>A simple http based API for controlling your Sonos system.</p>
            <p>There is a simple sandbox at /docs (incomplete atm)</p>
            <h2><a id="USAGE_17"></a>USAGE</h2>
            <p>Start by fixing your dependencies. Invoke the following command:</p>
            <p><code>npm install --production</code></p>
            <p>This will download the necessary dependencies if possible.</p>
            <p>start the server by running</p>
            <p><code>npm start</code></p>
            <p>Now you can control your system by invoking the following commands:</p>
            <pre><code>http://localhost:5005/zones
http://localhost:5005/lockvolumes
http://localhost:5005/unlockvolumes
http://localhost:5005/pauseall[/{timeout in minutes}]
http://localhost:5005/resumeall[/{timeout in minutes}]
http://localhost:5005/preset/{JSON preset}
http://localhost:5005/preset/{predefined preset name}
http://localhost:5005/reindex
http://localhost:5005/{room name}/sleep/{timeout in seconds or timestamp HH:MM:SS or off}
http://localhost:5005/{room name}/sleep/{timeout in seconds or timestamp HH:MM:SS or off}
http://localhost:5005/{room name}/{action}[/{parameter}]
</code></pre>
            <p>Example:</p>
            <p><code>http://localhost:5005/living room/volume/15</code> (will set volume for room Living Room to 15%)</p>
            <p><code>http://localhost:5005/living room/volume/+1</code> (will increase volume by 1%)</p>
            <p><code>http://localhost:5005/living room/next</code> (will skip to the next track on living room, unless it’s not a coordinator)</p>
            <p><code>http://localhost:5005/living room/pause</code> (will pause the living room)</p>
            <p><code>http://localhost:5005/living room/favorite/mysuperplaylist</code> (will replace queue with the favorite called “mysuperplaylist”)</p>
            <p><code>http://localhost:5005/living room/repeat/on</code> (will turn on repeat mode for group)</p>
            <p>The actions supported as of today:</p>
            <ul>
                <li>play</li>
                <li>pause</li>
                <li>playpause (toggles playing state)</li>
                <li>volume (parameter is absolute or relative volume. Prefix +/- indicates relative volume)</li>
                <li>groupVolume (parameter is absolute or relative volume. Prefix +/- indicates relative volume)</li>
                <li>mute / unmute</li>
                <li>groupMute / groupUnmute</li>
                <li>trackseek (parameter is queue index)</li>
                <li>timeseek (parameter is in seconds, 60 for 1:00, 120 for 2:00 etc)</li>
                <li>next</li>
                <li>previous</li>
                <li>state (will return a json-representation of the current state of player)</li>
                <li>favorite</li>
                <li>favorites (with optional “detailed” parameter)</li>
                <li>playlist</li>
                <li>lockvolumes / unlockvolumes (experimental, will enforce the volume that was selected when locking!)</li>
                <li>repeat (on/off)</li>
                <li>shuffle (on/off)</li>
                <li>crossfade (on/off)</li>
                <li>pauseall (with optional timeout in minutes)</li>
                <li>resumeall (will resume the ones that was pause on the pauseall call. Useful for doorbell, phone calls, etc. Optional timeout)</li>
                <li>say</li>
                <li>sayall</li>
                <li>queue</li>
                <li>clearqueue</li>
            </ul>
            <h2><a id="State_94"></a>State</h2>
            <p>Example of a state json:</p>
            <pre><code>{
  &quot;currentTrack&quot;:{
    &quot;artist&quot;:&quot;College&quot;,
    &quot;title&quot;:&quot;Teenage Color - Anoraak Remix&quot;,
    &quot;album&quot;:&quot;Nightdrive With You&quot;,
    &quot;albumArtURI&quot;:&quot;/getaa?s=1&amp;u=x-sonos-spotify%3aspotify%253atrack%253a3DjBDQs8ebkxMBo2V8V3SH%3fsid%3d9%26flags%3d32&quot;,
    &quot;duration&quot;:347,
    &quot;uri&quot;:&quot;x-sonos-spotify:spotify%3atrack%3a3DjBDQs8ebkxMBo2V8V3SH?sid=9&amp;flags=32&quot;
  },
  &quot;nextTrack&quot;:{
    &quot;artist&quot;:&quot;Blacknuss&quot;,
    &quot;title&quot;:&quot;Thinking of You&quot;,
    &quot;album&quot;:&quot;3&quot;,
    &quot;albumArtURI&quot;:&quot;/getaa?s=1&amp;u=x-sonos-spotify%3aspotify%253atrack%253a4U93TIa0X6jGQrTBGTkChH%3fsid%3d9%26flags%3d32&quot;,
    &quot;duration&quot;:235,
    &quot;uri&quot;:&quot;x-sonos-spotify:spotify%3atrack%3a4U93TIa0X6jGQrTBGTkChH?sid=9&amp;flags=32&quot;
  },
  &quot;volume&quot;:18,
  &quot;mute&quot;:false,
  &quot;trackNo&quot;:161,
  &quot;elapsedTime&quot;:200,
  &quot;elapsedTimeFormatted&quot;:&quot;03:20&quot;,
  &quot;zoneState&quot;:&quot;PAUSED_PLAYBACK&quot;,
  &quot;playerState&quot;:&quot;PLAYING&quot;,
  &quot;zonePlayMode&quot;:{
    &quot;shuffle&quot;:true,
    &quot;repeat&quot;:false,
    &quot;crossfade&quot;:false
  }
}
</code></pre>
            <h2><a id="Queue_130"></a>Queue</h2>
            <p>Obtain the current queue list from a specified player. The request will accept:</p>
            <ul>
                <li>
                    <p>No parameters</p>
                    <p><code>http://localhost:5005/living room/queue</code></p>
                </li>
                <li>
                    <p>Just a start index for the queue</p>
                    <p><code>http://localhost:5005/living room/queue/[start-index]</code></p>
                </li>
                <li>
                    <p>A start index and a count of items to return</p>
                    <p><code>http://localhost:5005/living room/queue/[start-index]/[count]</code></p>
                </li>
            </ul>
            <p>Example queue response:</p>
            <pre><code>{
  &quot;startIndex&quot;: &quot;0&quot;,
  &quot;numberReturned&quot;: 2,
  &quot;totalMatches&quot;: 33,
  &quot;items&quot;: [
    {
      &quot;uri&quot;: &quot;x-sonos-spotify:spotify%3atrack%3a0AvV49z4EPz5ocYN7eKGAK?sid=9&amp;flags=8224&amp;sn=3&quot;,
      &quot;albumArtURI&quot;: &quot;/getaa?s=1&amp;u=x-sonos-spotify%3aspotify%253atrack%253a0AvV49z4EPz5ocYN7eKGAK%3fsid%3d9%26flags%3d8224%26sn%3d3&quot;,
      &quot;title&quot;: &quot;No Diggity&quot;,
      &quot;artist&quot;: &quot;Blackstreet&quot;,
      &quot;album&quot;: &quot;Another Level&quot;
    },
    {
      &quot;uri&quot;: &quot;x-sonos-spotify:spotify%3atrack%3a5OQGeJ1ceykovrykZsGhqL?sid=9&amp;flags=8224&amp;sn=3&quot;,
      &quot;albumArtURI&quot;: &quot;/getaa?s=1&amp;u=x-sonos-spotify%3aspotify%253atrack%253a5OQGeJ1ceykovrykZsGhqL%3fsid%3d9%26flags%3d8224%26sn%3d3&quot;,
      &quot;title&quot;: &quot;Breathless&quot;,
      &quot;artist&quot;: &quot;The Corrs&quot;,
      &quot;album&quot;: &quot;In Blue&quot;
    }
  ]
}
</code></pre>
            <h2><a id="Preset_171"></a>Preset</h2>
            <p>A preset is a predefined grouping of players with predefined volumes, that will start playing whatever is in the coordinators queue.</p>
            <p>Example preset (state and uri are optional):</p>
            <pre><code>{
  &quot;players&quot;: [
    { &quot;roomName&quot;: &quot;room1&quot;, &quot;volume&quot;: 15},
    {&quot;roomName&quot;: &quot;room2&quot;, &quot;volume&quot;: 25}
  ],
  &quot;state&quot;: &quot;stopped&quot;,
  &quot;favorite&quot;: &quot;my favorite name&quot;,
  &quot;uri&quot;: &quot;x-rincon-stream:RINCON_0000000000001400&quot;,
  &quot;playMode&quot;: {
    &quot;shuffle&quot;: true
  },
  &quot;pauseOthers&quot;: true
}
</code></pre>
            <p>The first player listed in the example, “room1”, will become the coordinator. Playmode defines the three options “shuffle”, “repeat”, “crossfade” similar to the state. Favorite will have precedence over a uri. pauseOthers will pause all zones before applying the preset, effectively muting your system.</p>
            <h2><a id="presetsjson_197"></a>presets.json</h2>
            <p>You can create a file with pre made presets, called presets.json. It will be loaded upon start, any changes requires a restart of the server.</p>
            <p>Example content:</p>
            <pre><code class="language-json">{
  "<span class="hljs-attribute">all</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">playMode</span>": <span class="hljs-value">{
      "<span class="hljs-attribute">shuffle</span>": <span class="hljs-value"><span class="hljs-literal">true</span>
    </span>}</span>,
    "<span class="hljs-attribute">players</span>": <span class="hljs-value">[
      {
        "<span class="hljs-attribute">roomName</span>": <span class="hljs-value"><span class="hljs-string">"Bathroom"</span></span>,
        "<span class="hljs-attribute">volume</span>": <span class="hljs-value"><span class="hljs-number">10</span>
      </span>},
      {
        "<span class="hljs-attribute">roomName</span>": <span class="hljs-value"><span class="hljs-string">"Kitchen"</span></span>,
        "<span class="hljs-attribute">volume</span>": <span class="hljs-value"><span class="hljs-number">10</span>
      </span>},
      {
        "<span class="hljs-attribute">roomName</span>": <span class="hljs-value"><span class="hljs-string">"Office"</span></span>,
        "<span class="hljs-attribute">volume</span>": <span class="hljs-value"><span class="hljs-number">10</span>
      </span>},
      {
        "<span class="hljs-attribute">roomName</span>": <span class="hljs-value"><span class="hljs-string">"Bedroom"</span></span>,
        "<span class="hljs-attribute">volume</span>": <span class="hljs-value"><span class="hljs-number">10</span>
      </span>},
      {
        "<span class="hljs-attribute">roomName</span>": <span class="hljs-value"><span class="hljs-string">"TV Room"</span></span>,
        "<span class="hljs-attribute">volume</span>": <span class="hljs-value"><span class="hljs-number">15</span>
      </span>}
    ]</span>,
    "<span class="hljs-attribute">pauseOthers</span>": <span class="hljs-value"><span class="hljs-literal">true</span>
  </span>}</span>,
  "<span class="hljs-attribute">tv</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">players</span>": <span class="hljs-value">[
      {
        "<span class="hljs-attribute">roomName</span>": <span class="hljs-value"><span class="hljs-string">"TV Room"</span></span>,
        "<span class="hljs-attribute">volume</span>": <span class="hljs-value"><span class="hljs-number">20</span>
      </span>}
    ]</span>,
    "<span class="hljs-attribute">pauseOthers</span>": <span class="hljs-value"><span class="hljs-literal">true</span></span>,
    "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"x-rincon-stream:RINCON_000XXXXXXXXXX01400"</span>
  </span>}
</span>}
</code></pre>
            <p>In the example, there is one preset called <code>all</code>, which you can apply by invoking:</p>
            <p><code>http://localhost:5005/preset/all</code></p>
            <h2><a id="settingsjson_252"></a>settings.json</h2>
            <p>If you want to change default settings, you can create a settings.json file and put in the root folder.</p>
            <p>Available options are:</p>
            <ul>
                <li>port: change the listening port</li>
                <li>cacheDir: dir for tts files</li>
                <li>https: use https which requires a key and certificate or pfx file</li>
                <li>auth: require basic auth credentials which requires a username and password</li>
                <li>announceVolume: the percentual volume use when invoking say/sayall without any volume parameter</li>
            </ul>
            <p>Example:</p>
            <pre><code class="language-json">    {
      "<span class="hljs-attribute">voicerss</span>": <span class="hljs-value"><span class="hljs-string">"Your api key for TTS with voicerss"</span></span>,
      "<span class="hljs-attribute">port</span>": <span class="hljs-value"><span class="hljs-number">5005</span></span>,
      "<span class="hljs-attribute">securePort</span>": <span class="hljs-value"><span class="hljs-number">5006</span></span>,
      "<span class="hljs-attribute">cacheDir</span>": <span class="hljs-value"><span class="hljs-string">"./cache"</span></span>,
      "<span class="hljs-attribute">https</span>": <span class="hljs-value">{
        "<span class="hljs-attribute">key</span>": <span class="hljs-value"><span class="hljs-string">"/path/to/key.pem"</span></span>,
        "<span class="hljs-attribute">cert</span>" : <span class="hljs-value"><span class="hljs-string">"/path/to/cert.pem"</span>

        //... for pfx (alternative configuration)
        <span class="hljs-string">"pfx"</span>: <span class="hljs-string">"/path/to/pfx.pfx"</span></span>,
        "<span class="hljs-attribute">passphrase</span>": <span class="hljs-value"><span class="hljs-string">"your-passphrase-if-applicable"</span>
      </span>}</span>,
      "<span class="hljs-attribute">auth</span>": <span class="hljs-value">{
        "<span class="hljs-attribute">username</span>": <span class="hljs-value"><span class="hljs-string">"admin"</span></span>,
        "<span class="hljs-attribute">password</span>": <span class="hljs-value"><span class="hljs-string">"password"</span>
      </span>}</span>,
      "<span class="hljs-attribute">announceVolume</span>": <span class="hljs-value"><span class="hljs-number">40</span>
    </span>}
</code></pre>
            <p>Override as it suits you.</p>
            <h2><a id="Favorites_292"></a>Favorites</h2>
            <p>It has support for starting favorites. Simply invoke:</p>
            <p><code>http://localhost:5005/living room/favorite/[favorite name]</code></p>
            <p>and it will replace the queue with that favorite. Bear in mind that favorites may share name, which might give unpredictable behavior at the moment.</p>
            <h2><a id="Playlist_301"></a>Playlist</h2>
            <p>Playing a Sonos playlist is supported. Invoke the following:</p>
            <p><code>http://localhost:5005/living room/playlist/[playlist name]</code></p>
            <p>and it will replace the queue with the playlist and starts playing.</p>
            <h2><a id="Say_TTS_support_311"></a>Say (TTS support)</h2>
            <p>Experimental support for TTS. This REQUIRES a registered API key from voiceRSS! See <a href="http://www.voicerss.org/">http://www.voicerss.org/</a> for info.</p>
            <p>You need to add this to a file called settings.json (create if it doesn’t exist), like this:</p>
            <pre><code>{
  &quot;voicerss&quot;: &quot;f5e77e1d42063175b9219866129189a3&quot;
}
</code></pre>
            <p>Replace the code above (it is just made up) with the api-key you’ve got after registering.</p>
            <p>Action is:</p>
            <pre><code>/[Room name]/say/[phrase][/[language_code]][/[announce volume]]
/sayall/[phrase][/[language_code]][/[announce volume]]
</code></pre>
            <p>Example:</p>
            <pre><code>/Office/say/Hello, dinner is ready
/Office/say/Hej, maten är klar/sv-se
/sayall/Hello, dinner is ready
/Office/say/Hello, dinner is ready/90
/Office/say/Hej, maten är klar/sv-se/90
</code></pre>
            <p>language code needs to be before volume if specified.</p>
            <p>Sayall will group all players, set 40% volume (by default) and then try and restore everything as the way it where. Please try it out, it will probably contain glitches but please report detailed descriptions on what the problem is (starting state, error that occurs, and the final state of your system).</p>
            <p>The supported language codes are:</p>
            <table>
                <tr>
                    <td>ca-es</td>
                    <td>Catalan</td>
                </tr>
                <tr>
                    <td>zh-cn</td>
                    <td>Chinese (China)</td>
                </tr>
                <tr>
                    <td>zh-hk</td>
                    <td>Chinese (Hong Kong)</td>
                </tr>
                <tr>
                    <td>zh-tw</td>
                    <td>Chinese (Taiwan)</td>
                </tr>
                <tr>
                    <td>da-dk</td>
                    <td>Danish</td>
                </tr>
                <tr>
                    <td>nl-nl</td>
                    <td>Dutch</td>
                </tr>
                <tr>
                    <td>en-au</td>
                    <td>English (Australia)</td>
                </tr>
                <tr>
                    <td>en-ca</td>
                    <td>English (Canada)</td>
                </tr>
                <tr>
                    <td>en-gb</td>
                    <td>English (Great Britain)</td>
                </tr>
                <tr>
                    <td>en-in</td>
                    <td>English (India)</td>
                </tr>
                <tr>
                    <td>en-us</td>
                    <td>English (United States)</td>
                </tr>
                <tr>
                    <td>fi-fi</td>
                    <td>Finnish</td>
                </tr>
                <tr>
                    <td>fr-ca</td>
                    <td>French (Canada)</td>
                </tr>
                <tr>
                    <td>fr-fr</td>
                    <td>French (France)</td>
                </tr>
                <tr>
                    <td>de-de</td>
                    <td>German</td>
                </tr>
                <tr>
                    <td>it-it</td>
                    <td>Italian</td>
                </tr>
                <tr>
                    <td>ja-jp</td>
                    <td>Japanese</td>
                </tr>
                <tr>
                    <td>ko-kr</td>
                    <td>Korean</td>
                </tr>
                <tr>
                    <td>nb-no</td>
                    <td>Norwegian</td>
                </tr>
                <tr>
                    <td>pl-pl</td>
                    <td>Polish</td>
                </tr>
                <tr>
                    <td>pt-br</td>
                    <td>Portuguese (Brazil)</td>
                </tr>
                <tr>
                    <td>pt-pt</td>
                    <td>Portuguese (Portugal)</td>
                </tr>
                <tr>
                    <td>ru-ru</td>
                    <td>Russian</td>
                </tr>
                <tr>
                    <td>es-mx</td>
                    <td>Spanish (Mexico)</td>
                </tr>
                <tr>
                    <td>es-es</td>
                    <td>Spanish (Spain)</td>
                </tr>
                <tr>
                    <td>sv-se</td>
                    <td>Swedish (Sweden)</td>
                </tr>
            </table>
            <h2><a id="Spotify_Apple_Music_and_SiriusXM_Experimental_372"></a>Spotify, Apple Music, and SiriusXM (Experimental)</h2>
            <p>The following endpoints are available:</p>
            <pre><code># Spotify
/RoomName/spotify/now/spotify:track:4LI1ykYGFCcXPWkrpcU7hn
/RoomName/spotify/next/spotify:track:4LI1ykYGFCcXPWkrpcU7hn
/RoomName/spotify/queue/spotify:track:4LI1ykYGFCcXPWkrpcU7hn

# Apple Music
/RoomName/applemusic/{now,next,queue}/song:{songID}
/RoomName/applemusic/{now,next,queue}/album:{albumID}
/RoomName/applemusic/queue/name:{artist name, song title, artist name &amp; song title}
/RoomName/applemusic/radio/radio:{artist name, song title, artist name &amp; song title}

# SiriusXM
/RoomName/siriusXM/{channel number,station name}
</code></pre>
            <p>You can find Apple Music song and album IDs via the <a href="https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/">iTunes Search
API</a>.</p>
            <p>You can specify an artist name, song title, or combination of the two, iTunes search will be searched automatically, and the results will be played. With the radio action you can specify the same and an Apple Music Radio station for the artist or track will be played.</p>
            <p>It only handles a single spotify account currently. It will probably use the first account added on your system.</p>
            <p>You can specify a SiriusXM channel number or station name and the station will be played.</p>
            <p>Experiment with these and leave feedback!</p>
            <h2><a id="Webhook_418"></a>Webhook</h2>
            <p>NOTE! This is experimental and might change in the future! Please leave your feedback as github issues if you feel like it doesn’t suit your need, since I don’t know what kind of restrictions you will be facing.</p>
            <p>If you add a setting in settings.json like this:</p>
            <pre><code>{
  &quot;webhook&quot;: &quot;http://localhost:5007/&quot;
}
</code></pre>
            <p>Every state change, topology change and volume change will be posted (method POST) to that URL, as JSON. The following data structure will be sent:</p>
            <pre><code>{
  &quot;type&quot;: &quot;transport-state&quot;,
  &quot;data&quot;: { (snapshot of player) }
}
</code></pre>
            <p>or</p>
            <pre><code>{
  &quot;type&quot;: &quot;topology-change&quot;,
  &quot;data&quot;: { (snapshot of zones) }
}
</code></pre>
            <p>or</p>
            <pre><code>{
  &quot;type&quot;: &quot;volume-change&quot;,
  &quot;data&quot;: { (snapshot of volume) }
}
</code></pre>
            <p>“data” property will be equal to the same data as you would get from /RoomName/state or /zones. There is an example endpoint in the root if this project called test_endpoint.js which you may fire up to get an understanding of what is posted, just invoke it with “node test_endpoint.js” in a terminal, and then start the http-api in another terminal.</p>
            <h2>Pre-composed raspberry pi image</h2>
            <p>There is a pre-composed image based on AlpineLinux available for simplicitly. This is a cross-version build that runs on raspberry pi B/B+, 2 and version 3. For more information on AlpineLinux, visit <a href="http://www.alpinelinux.org/">their homepage</a> and read the wiki.</p>
            <p>The system will run from a RAM-drive, except for the files related to Sonos HTTP API. Because of this, it should be fairly resistent against powercuts or sudden resets. The tear on the SD-card should only be minimal</p>
            <p>The sshd daemon will generate new host keys upon first boot, and persist these for future boots. By default the root user has no password, if you want to set a password, just SSH to that machine and set a new root password.</p>
            <p>It also has samba installed by default, and sharing the /flash folder with read/write permissions for easier access. Just visit \\sonos from a windows machine or smb://sonos from macOS (replace sonos with the IP if it doesn't work)</p>
            <p>To write the image to an SD-card, use the <pre>dd</pre> command on Linux and OS X, or <a href="https://sourceforge.net/projects/win32diskimager/">Win32DiskWriter</a> for Windows.</p>
        </section>
    </div>
</body>

</html>
